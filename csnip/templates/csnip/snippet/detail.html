<meta name = "viewport" charset="utf-8" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
{% extends "base.html" %}
{% load crispy_forms_tags %}


{% block content %}
<style media="screen">
  .div-snipexp{
    padding-right:100px;
  }

  .div-snipexp1{

    padding-top:20px;
  }

  .div-snipbody{
    padding-left:100px;
  }

  .div-sniptitle{
    padding-left:100px;
    padding-top:20px;
  }

  .exp-header{

    padding-top:0px;
  }

  .div-snipbody:after {
    content: '';
    position: absolute;
    right: 0;
    border-right: 2px dotted #cfc7c0;
    top: 0%;
    bottom: 0%;
}
</style>



      <div class="row">
        <div class="div-sniptitle col-md-6">
            <h4><a href="{{ snippet.get_absolute_url }}">{{ snippet.title }}</a></h4>
        </div>
        <div class="div-snipexp1 col-md-6">
            <h4><code>Explanation</code></h4>
        </div>


        <br>

      </div>



<div class="row">




      <div class="col-md-6 div-snipbody">
        <br>
        <pre class="precode">
<b>{{ snippet.body|safe }}</b>
        </pre>
      </div>


      <div class="col-md-6 div-snipexp">
        <br>
        <b>{{ snippet.explanation|safe }}</b>
      </div>









</div>
<button type="submit" onclick = "location.href='{% url 'csnip:delete' snippet.id %}';" name="button">Delete Snip</button>
<!--  -->
<p>
  <a href="{% url 'csnip:snippet_share' snippet.id %}">
  Share this post</a>
</p>

<div class="likes">
{% with total_likes=snippet.user_like.count user_like=snippet.user_like.all %}

    <span class="count">
      <span class="total">{{ total_likes }}</span>
      likes
      <!-- {{ total_likes }} likes -->
    </span>
    <a href="#" data-id="{{ snippet.id }}" id = "{{ snippet.id }}"
      data-action="{% if request.user in user_like %}un{% endif %}like" class="like">

      {% if request.user not in user_like %}
        like
      {% else %}
        unlike
      {% endif %}
    </a>
{% endwith %}

</div>

<h2>Similar Snippets </h2>
{% for snippet in similar_snippets %}
  <p>
    <a href="{{ snippet.get_absoulte_url }}">{{ snippet.title }}</a>
  </p>
{% empty %}
  There are no similar snippets yet.
{% endfor %}



{% with comments.count as total_comments %}
  <h2>
    {{ total_comments }} comment {{ total_comments|pluralize }}
  </h2>
{% endwith %}

{% for comment in comments %}
  <div class="comment">
    <p class="info">
      Comment {{ forloop.counter }} by {{ comment.name }}
      {{ comment.created }}
    </p>
    {{ comment.body|linebreaks }}

  </div>
{% empty %}
    <p>There are no comments yet.</p>
{% endfor %}

{% if new_comment %}
  <h2>Your comment has been added. </h2>
  <h2>Add Another one?</h2>
  <form class="" action="." method="post">
    {{ comment_form|crispy }}
    {% csrf_token %}
    <p><input type="submit" name="" value="Add comment"></p>
  </form>
{% else %}
  <h2>Add a new comment </h2>
  <form class="" action="." method="post">
    {{ comment_form|crispy }}
    {% csrf_token %}
    <p><input type="submit" name="" value="Add comment"></p>
  </form>
{% endif %}






{% block paginator %}{% endblock %}
{% block footer %}{% endblock %}
{% endblock %}

{% block domready %}

  $('a.like').click(function(e){
    e.preventDefault();
    $.post('{% url 'csnip:like' %}',
    {
      id:$(this).data('id'),
      action: $(this).data('action')
    },
    function(data){
      if (data['status'] == 'ok'){
        var previous_action = $('a.like').data('action');

        $('a.like').data('action', previous_action == 'like' ? 'unlike' : 'like');


        $('a.like').text(previous_action == 'like' ? 'unlike' : 'like');

        var previous_likes = parseInt($('span.count .total').text());
        $('span.count .total').text(previous_action == 'like' ? previous_likes + 1 : previous_likes - 1);

      }
    });
  });
{% endblock %}
